CREATE TABLE TACPHAM(
	NT 		smallint primary key ,
	tua 		varchar(150),
	tacgia 		varchar(100)
);

CREATE TABLE DOCGIA (
	ND		smallint PRIMARY KEY ,
	ho		VARCHAR(30),
	ten		VARCHAR(30),
	dchi	VARCHAR(100),
	tel		CHAR(10)
);

CREATE TABLE SACH (
	NS		smallint primary key ,
	nxb		varchar(50),
	NT		smallint not null, 
 	foreign key(NT) references TACPHAM(NT)
);

CREATE TABLE MUON (
	NS		smallint not NULL, 
	foreign key(NS) references SACH(NS),
	ngaymuon	date not NULL,
	hantra	date not null,
	ngaytra 	date,
	ND		smallint not null, 
	foreign key(ND) references DOCGIA(ND),
	primary key 	(NS, ngaymuon)
);


INSERT INTO TACPHAM VALUES (1,'Les miserables','Victor Hugo');
INSERT INTO TACPHAM VALUES (2,'Germinal ','Emile Zola');
INSERT INTO TACPHAM VALUES (3,'Madame Bovary','Gustave Flaubert');
INSERT INTO TACPHAM VALUES (4,'Les Fleurs du mal','Charles Baudelaire');
INSERT INTO TACPHAM VALUES (5,'La Bete Humaine','Emile Zola');
INSERT INTO TACPHAM VALUES (6,'Le Pere Goriot ','Honore de Balzac');
INSERT INTO TACPHAM VALUES (7,'Le Rouge et le Noir','Stendhal');
INSERT INTO TACPHAM VALUES (8,'Une vie','Guy de Maupassant');
INSERT INTO TACPHAM VALUES (9,'Ubu Roi','Alfred Jarry');
INSERT INTO TACPHAM VALUES (10,'Poésie','Arthur Rimbaud');
INSERT INTO TACPHAM VALUES (11,'La Mare au Diable','George Sand');
INSERT INTO TACPHAM VALUES (12,'Carmen','Prosper Merimee');
INSERT INTO TACPHAM VALUES (13,'Lettres de mon moulin','Alphonse Daudet');
INSERT INTO TACPHAM VALUES (14,'Les contes du chat perché','Marcel Ayme');
INSERT INTO TACPHAM VALUES (15,'La Peste','Albert Camus');
INSERT INTO TACPHAM VALUES (16,'Le petit prince','Antoine de St Exupery');


INSERT INTO DOCGIA VALUES (1,'Lecoeur','Jeanette','16 rue de la République, 75010 Paris','0145279274');
INSERT INTO DOCGIA VALUES (2,'Lecoeur','Philippe','16 rue de la République, 75010 Paris','0145279274');
INSERT INTO DOCGIA VALUES (3,'Dupont','Yvan','73 rue Lamarck, 75018 Paris','0163538294');
INSERT INTO DOCGIA VALUES (4,'Mercier','Claude','155 avenue Parmentier, 75011 Paris','0136482736');
INSERT INTO DOCGIA VALUES (5,'Léger','Marc','90 avenue du Maine, 75014 Paris','0164832947');
INSERT INTO DOCGIA VALUES (6,'Martin','Laure','51 boulevard Diderot, 75012 Paris','0174693277');
INSERT INTO DOCGIA VALUES (7,'Crozier','Martine','88 rue des Portes Blanches, 75018 Paris','0146829384');
INSERT INTO DOCGIA VALUES (8,'Lebon','Clément','196 boulevard de Sebastopol, 75001 Paris','0132884739');
INSERT INTO DOCGIA VALUES (9,'Dufour','Jacques','32 rue des Alouettes, 75003 Paris','0155382940');
INSERT INTO DOCGIA VALUES (10,'Dufour','Antoine','32 rue des Alouettes, 75003 Paris','0155382940');
INSERT INTO DOCGIA VALUES (11,'Dufour','Stéphanie','32 rue des Alouettes, 75003 Paris','0155382940');
INSERT INTO DOCGIA VALUES (12,'Raymond','Carole','35 rue Oberkampf, 75011 Paris','0153829402');
INSERT INTO DOCGIA VALUES (13,'Durand','Albert','4 rue Mandar, 75002 Paris','0642374021');
INSERT INTO DOCGIA VALUES (14,'Wilson','Paul','12 rue Paul Vaillant Couturier, 92400 Montrouge','0642327407');
INSERT INTO DOCGIA VALUES (15,'Grecault','Philippe','15 rue de la Roquette, 75012 Paris','0132762983');
INSERT INTO DOCGIA VALUES (16,'Carre','Stéphane','51 boulevard Diderot, 75012 Paris','0174693277');
INSERT INTO DOCGIA VALUES (17,'Johnson','Astrid','3 rue Léon Blum, 75002 Paris','0143762947');
INSERT INTO DOCGIA VALUES (18,'Mirou','Caroline','2 square Mirabeau, 75011 Paris','0163827399');
INSERT INTO DOCGIA VALUES (19,'Espelette','Jean-Jacques','141 avenue de France, 75019 Paris','0134887264');
INSERT INTO DOCGIA VALUES (20,'Despentes','Anthony','56 boulevard de la Villette, 75019 Paris','0133889463');
INSERT INTO DOCGIA VALUES (21,'Terlu','Véronique','45 rue des Batignolles, 75020 Paris','0165998372');
INSERT INTO DOCGIA VALUES (22,'Rihour','Cécile','7 rue Montorgueil, 75002 Paris','0166894754');
INSERT INTO DOCGIA VALUES (23,'Franchet','Pierre','160 rue Montmartre, 75009 Paris','0633628549');
INSERT INTO DOCGIA VALUES (24,'Trochet','Ernest','34 rue de l''Esperance, 75008 Paris','0638295563');
INSERT INTO DOCGIA VALUES (25,'Gainard','Simon','55 rue Desnouettes, 75015 Paris','0174928934');
INSERT INTO DOCGIA VALUES (26,'Touche','Johanna','14 rue du Bac, 75006 Paris','0619384065');
INSERT INTO DOCGIA VALUES (27,'Cornu','Sylvain','22 rue Mouffetard, 75005 Paris','0184927489');
INSERT INTO DOCGIA VALUES (28,'Frederic','Cyril','15 rue du Simplon, 75018 Paris','0173625492');
INSERT INTO DOCGIA VALUES (29,'Crestard','Cedric','5 rue Doudeauville, 75018 Paris','0629485700');
INSERT INTO DOCGIA VALUES (30,'Le Bihan','Karine','170 bis rue Ordener, 75018 Paris','0638995221');

INSERT INTO SACH VALUES (1,'GF',1);
INSERT INTO SACH VALUES (2,'FOLIO',2);
INSERT INTO SACH VALUES (3,'HACHETTE',3);
INSERT INTO SACH VALUES (4,'GF',4);
INSERT INTO SACH VALUES (5,'FOLIO',5);
INSERT INTO SACH VALUES (6,'FOLIO',6);
INSERT INTO SACH VALUES (7,'GF',7);
INSERT INTO SACH VALUES (8,'FOLIO',8);
INSERT INTO SACH VALUES (9,'HACHETTE',9);
INSERT INTO SACH VALUES (10,'GF',10);
INSERT INTO SACH VALUES (11,'HACHETTE',11);
INSERT INTO SACH VALUES (12,'FOLIO',12);
INSERT INTO SACH VALUES (13,'GF',13);
INSERT INTO SACH VALUES (14,'FOLIO',14);
INSERT INTO SACH VALUES (15,'HACHETTE',15);
INSERT INTO SACH VALUES (16,'HACHETTE',16);
INSERT INTO SACH VALUES (17,'GF',1);
INSERT INTO SACH VALUES (18,'FOLIO',2);
INSERT INTO SACH VALUES (19,'HACHETTE',2);
INSERT INTO SACH VALUES (20,'FOLIO',4);
INSERT INTO SACH VALUES (21,'GF',5);
INSERT INTO SACH VALUES (22,'HACHETTE',4);
INSERT INTO SACH VALUES (23,'HACHETTE',7);
INSERT INTO SACH VALUES (24,'FOLIO',8);
INSERT INTO SACH VALUES (25,'GF',1);
INSERT INTO SACH VALUES (26,'HACHETTE',10);
INSERT INTO SACH VALUES (27,'FOLIO',11);
INSERT INTO SACH VALUES (28,'FOLIO',12);
INSERT INTO SACH VALUES (29,'GF',1);
INSERT INTO SACH VALUES (30,'HACHETTE',14);

alter session set nls_date_format='yyyy-mm-dd'; 
-- loi ko chinh ngay duoc

-- INSERT INTO MUON VALUES (1,'2007-9-2','2007-9-16','2007-9-7',1);
-- INSERT INTO MUON VALUES (1,'2006-10-1','2006-10-15','2006-10-11',26);
-- INSERT INTO MUON VALUES (1,'2007-6-14','2007-6-28','2007-6-19',2);
-- INSERT INTO MUON VALUES (1,'2007-4-27','2007-5-11','2007-5-8',3);
-- INSERT INTO MUON VALUES (2,'2007-8-23','2007-9-6','2007-9-2',4);
-- INSERT INTO MUON VALUES (2,'2007-10-6','2007-10-20', NULL,28);
-- INSERT INTO MUON VALUES (9,'2007-10-6','2007-10-20', NULL,28);
-- INSERT INTO MUON VALUES (3,'2007-9-9','2007-9-23','2007-9-13',3);
-- INSERT INTO MUON VALUES (4,'2007-2-8','2007-2-22','2007-2-12',12);
-- INSERT INTO MUON VALUES (4,'2006-2-7','2006-2-21','2006-2-20',4);
-- INSERT INTO MUON VALUES (4,'2007-6-17','2007-7-1','2007-6-27',5);
-- INSERT INTO MUON VALUES (5,'2007-10-4','2007-10-19', NULL,16);
-- INSERT INTO MUON VALUES (6,'2007-3-11','2007-3-25','2007-3-16',3);
-- INSERT INTO MUON VALUES (8,'2007-7-14','2007-7-28','2007-7-20',18);
-- INSERT INTO MUON VALUES (8,'2007-3-9','2007-3-23','2007-3-27',13);
-- INSERT INTO MUON VALUES (10,'2007-4-11','2007-4-25','2007-4-23',8);
-- INSERT INTO MUON VALUES (10,'2006-1-27','2006-2-10','2006-1-31',7);
-- INSERT INTO MUON VALUES (11,'2007-10-1','2007-10-15', NULL,22);
-- INSERT INTO MUON VALUES (12,'2003-3-3','2003-3-17','2003-3-13',7);
-- INSERT INTO MUON VALUES (14,'2007-10-2','2007-10-16', NULL,1);
-- INSERT INTO MUON VALUES (15,'2007-5-4','2007-5-18','2007-5-12',10);
-- INSERT INTO MUON VALUES (16,'2007-10-5','2007-10-19', NULL,2);
-- INSERT INTO MUON VALUES (18,'2007-7-4','2007-7-18','2007-7-11',3);
-- INSERT INTO MUON VALUES (20,'2006-12-17','2006-12-31','2006-12-17',27);
-- INSERT INTO MUON VALUES (20,'2007-9-6','2007-9-20','2007-9-22',9);
-- INSERT INTO MUON VALUES (21,'2007-9-7','2007-9-21','2007-9-19',14);
-- INSERT INTO MUON VALUES (24,'2007-2-14','2007-2-28','2007-2-20',26);
-- INSERT INTO MUON VALUES (25,'2006-8-19','2006-9-2','2006-9-3',1);
-- INSERT INTO MUON VALUES (26,'2006-11-15','2006-11-29','2006-11-22',9);
-- INSERT INTO MUON VALUES (29,'2007-9-20','2007-10-4', NULL,27);

INSERT INTO MUON VALUES (1, TO_DATE('2007-09-02','YYYY-MM-DD'), TO_DATE('2007-09-16','YYYY-MM-DD'), TO_DATE('2007-09-07','YYYY-MM-DD'), 1);
INSERT INTO MUON VALUES (1, TO_DATE('2006-10-01','YYYY-MM-DD'), TO_DATE('2006-10-15','YYYY-MM-DD'), TO_DATE('2006-10-11','YYYY-MM-DD'), 26);
INSERT INTO MUON VALUES (1, TO_DATE('2007-06-14','YYYY-MM-DD'), TO_DATE('2007-06-28','YYYY-MM-DD'), TO_DATE('2007-06-19','YYYY-MM-DD'), 2);
INSERT INTO MUON VALUES (1, TO_DATE('2007-04-27','YYYY-MM-DD'), TO_DATE('2007-05-11','YYYY-MM-DD'), TO_DATE('2007-05-08','YYYY-MM-DD'), 3);
INSERT INTO MUON VALUES (2, TO_DATE('2007-08-23','YYYY-MM-DD'), TO_DATE('2007-09-06','YYYY-MM-DD'), TO_DATE('2007-09-02','YYYY-MM-DD'), 4);
INSERT INTO MUON VALUES (2, TO_DATE('2007-10-06','YYYY-MM-DD'), TO_DATE('2007-10-20','YYYY-MM-DD'), NULL, 28);
INSERT INTO MUON VALUES (9, TO_DATE('2007-10-06','YYYY-MM-DD'), TO_DATE('2007-10-20','YYYY-MM-DD'), NULL, 28);
INSERT INTO MUON VALUES (3, TO_DATE('2007-09-09','YYYY-MM-DD'), TO_DATE('2007-09-23','YYYY-MM-DD'), TO_DATE('2007-09-13','YYYY-MM-DD'), 3);
INSERT INTO MUON VALUES (4, TO_DATE('2007-02-08','YYYY-MM-DD'), TO_DATE('2007-02-22','YYYY-MM-DD'), TO_DATE('2007-02-12','YYYY-MM-DD'), 12);
INSERT INTO MUON VALUES (4, TO_DATE('2006-02-07','YYYY-MM-DD'), TO_DATE('2006-02-21','YYYY-MM-DD'), TO_DATE('2006-02-20','YYYY-MM-DD'), 4);
INSERT INTO MUON VALUES (4, TO_DATE('2007-06-17','YYYY-MM-DD'), TO_DATE('2007-07-01','YYYY-MM-DD'), TO_DATE('2007-06-27','YYYY-MM-DD'), 5);
INSERT INTO MUON VALUES (5, TO_DATE('2007-10-04','YYYY-MM-DD'), TO_DATE('2007-10-19','YYYY-MM-DD'), NULL, 16);
INSERT INTO MUON VALUES (6, TO_DATE('2007-03-11','YYYY-MM-DD'), TO_DATE('2007-03-25','YYYY-MM-DD'), TO_DATE('2007-03-16','YYYY-MM-DD'), 3);
INSERT INTO MUON VALUES (8, TO_DATE('2007-07-14','YYYY-MM-DD'), TO_DATE('2007-07-28','YYYY-MM-DD'), TO_DATE('2007-07-20','YYYY-MM-DD'), 18);
INSERT INTO MUON VALUES (8, TO_DATE('2007-03-09','YYYY-MM-DD'), TO_DATE('2007-03-23','YYYY-MM-DD'), TO_DATE('2007-03-27','YYYY-MM-DD'), 13);
INSERT INTO MUON VALUES (10, TO_DATE('2007-04-11','YYYY-MM-DD'), TO_DATE('2007-04-25','YYYY-MM-DD'), TO_DATE('2007-04-23','YYYY-MM-DD'), 8);
INSERT INTO MUON VALUES (10, TO_DATE('2006-01-27','YYYY-MM-DD'), TO_DATE('2006-02-10','YYYY-MM-DD'), TO_DATE('2006-01-31','YYYY-MM-DD'), 7);
INSERT INTO MUON VALUES (11, TO_DATE('2007-10-01','YYYY-MM-DD'), TO_DATE('2007-10-15','YYYY-MM-DD'), NULL, 22);
INSERT INTO MUON VALUES (12, TO_DATE('2003-03-03','YYYY-MM-DD'), TO_DATE('2003-03-17','YYYY-MM-DD'), TO_DATE('2003-03-13','YYYY-MM-DD'), 7);
INSERT INTO MUON VALUES (14, TO_DATE('2007-10-02','YYYY-MM-DD'), TO_DATE('2007-10-16','YYYY-MM-DD'), NULL, 1);
INSERT INTO MUON VALUES (15, TO_DATE('2007-05-04','YYYY-MM-DD'), TO_DATE('2007-05-18','YYYY-MM-DD'), TO_DATE('2007-05-12','YYYY-MM-DD'), 10);
INSERT INTO MUON VALUES (16, TO_DATE('2007-10-05','YYYY-MM-DD'), TO_DATE('2007-10-19','YYYY-MM-DD'), NULL, 2);
INSERT INTO MUON VALUES (18, TO_DATE('2007-07-04','YYYY-MM-DD'), TO_DATE('2007-07-18','YYYY-MM-DD'), TO_DATE('2007-07-11','YYYY-MM-DD'), 3);
INSERT INTO MUON VALUES (20, TO_DATE('2006-12-17','YYYY-MM-DD'), TO_DATE('2006-12-31','YYYY-MM-DD'), TO_DATE('2006-12-17','YYYY-MM-DD'), 27);
INSERT INTO MUON VALUES (20, TO_DATE('2007-09-06','YYYY-MM-DD'), TO_DATE('2007-09-20','YYYY-MM-DD'), TO_DATE('2007-09-22','YYYY-MM-DD'), 9);
INSERT INTO MUON VALUES (21, TO_DATE('2007-09-07','YYYY-MM-DD'), TO_DATE('2007-09-21','YYYY-MM-DD'), TO_DATE('2007-09-19','YYYY-MM-DD'), 14);
INSERT INTO MUON VALUES (24, TO_DATE('2007-02-14','YYYY-MM-DD'), TO_DATE('2007-02-28','YYYY-MM-DD'), TO_DATE('2007-02-20','YYYY-MM-DD'), 26);
INSERT INTO MUON VALUES (25, TO_DATE('2006-08-19','YYYY-MM-DD'), TO_DATE('2006-09-02','YYYY-MM-DD'), TO_DATE('2006-09-03','YYYY-MM-DD'), 1);
INSERT INTO MUON VALUES (26, TO_DATE('2006-11-15','YYYY-MM-DD'), TO_DATE('2006-11-29','YYYY-MM-DD'), TO_DATE('2006-11-22','YYYY-MM-DD'), 9);
INSERT INTO MUON VALUES (29, TO_DATE('2007-09-20','YYYY-MM-DD'), TO_DATE('2007-10-04','YYYY-MM-DD'), NULL, 27);

-- cau1
SELECT NT, tua FROM TACPHAM WHERE TACGIA = 'Guy de Maupassant';

-- cau2
SELECT * FROM DOCGIA WHERE dchi = '32 rue des Alouettes, 75003 Paris';

-- cau3
SELECT nxb FROM SACH WHERE NT IN ( SELECT NT FROM TACPHAM WHERE tua LIKE '%Fleur%');

-- cau4
SELECT tua FROM TACPHAM WHERE tua LIKE '%Le%';

-- cau5
SELECT ho, ten FROM DOCGIA WHERE ND IN (SELECT ND FROM MUON WHERE ngaymuon BETWEEN TO_DATE('15/9/2007', 'DD/MM/YYYY') AND TO_DATE('20/9/2007', 'DD/MM/YYYY'));

-- cau6
SELECT COUNT(DISTINCT NT) FROM TACPHAM;

-- cau7
SELECT tacgia, COUNT(NT) AS sotacpham FROM TACPHAM GROUP BY tacgia;

-- cau8
SELECT COUNT(*) FROM (SELECT tacgia, COUNT(NT) AS sotacpham FROM TACPHAM GROUP BY tacgia HAVING COUNT(*) >=2 );

-- cau9
SELECT tua, COUNT(NS) AS sosach FROM SACH JOIN tacpham ON SACH.NT = TACPHAM.NT GROUP BY tua;

-- cau10
SELECT tua, sosach FROM (SELECT tua, COUNT(NS) AS sosach FROM SACH JOIN tacpham ON SACH.NT = TACPHAM.NT GROUP BY tua) WHERE sosach = (SELECT MAX(sosach) FROM (SELECT tua, COUNT(NS) AS sosach FROM SACH JOIN tacpham ON SACH.NT = TACPHAM.NT GROUP BY tua));

-- cau11
SELECT nxb, sosach FROM (SELECT nxb, COUNT(NS) AS sosach FROM SACH GROUP BY  nxb) WHERE sosach = (SELECT MAX(sosach) FROM (SELECT nxb, COUNT(NS) AS sosach FROM SACH GROUP BY nxb));

-- cau12
SELECT DISTINCT nxb FROM SACH WHERE NT = (SELECT NT FROM TACPHAM WHERE tua = 'Germinal ');

-- cau13
SELECT tua, COUNT(NS) AS sosach FROM SACH JOIN TACPHAM ON SACH.NT = TACPHAM.NT GROUP BY tua HAVING COUNT(NS) >= 2;

-- cau14
SELECT ho, ten FROM DOCGIA WHERE ND IN (SELECT ND FROM MUON WHERE NS IN (SELECT NS FROM SACH WHERE NT IN(SELECT NT FROM TACPHAM WHERE tua = 'Poésie')));

-- cau15
SELECT ho, ten FROM DOCGIA WHERE ND IN (SELECT ND FROM MUON WHERE NS IN (SELECT NS FROM SACH WHERE NT IN( SELECT NT FROM TACPHAM WHERE tua = 'Les Fleurs du mal' )));

-- cau16
SELECT to_char (ngaymuon, 'YYYY') nam, ten, COUNT (*) AS solanmuon FROM MUON JOIN DOCGIA ON MUON.ND = DOCGIA.ND GROUP BY ten, to_char (ngaymuon, 'YYYY');

-- cau17
SELECT tua, ten FROM TACPHAM JOIN SACH ON TACPHAM.NT = SACH.NT JOIN MUON ON MUON.NS = SACH.NS JOIN DOCGIA ON DOCGIA.ND = MUON.ND WHERE ngaytra IS NULL;

-- cau18
SELECT tua, ten FROM TACPHAM JOIN SACH ON TACPHAM.NT = SACH.NT JOIN MUON ON MUON.NS = SACH.NS JOIN DOCGIA ON DOCGIA.ND = MUON.ND WHERE ngaytra > hantra;

-- cau19
SELECT tua, ten FROM TACPHAM JOIN SACH ON TACPHAM.NT = SACH.NT JOIN MUON ON MUON.NS = SACH.NS JOIN DOCGIA ON DOCGIA.ND = MUON.ND WHERE ngaytra < hantra;

-- cau20
SELECT tua, solanmuon FROM (SELECT tua, COUNT(*)  AS solanmuon FROM TACPHAM JOIN SACH ON TACPHAM.NT = SACH.NT JOIN MUON ON MUON.NS = SACH.NS GROUP BY tua) WHERE solanmuon = (SELECT MAX(solanmuon) FROM (SELECT tua, COUNT(*) AS solanmuon FROM TACPHAM JOIN SACH ON TACPHAM.NT = SACH.NT JOIN MUON ON MUON.NS = SACH.NS GROUP BY tua));

-- cau21
SELECT tua, solanmuon FROM (SELECT tua, COUNT(*) AS solanmuon FROM TACPHAM JOIN SACH ON TACPHAM.NT = SACH.NT JOIN MUON ON MUON.NS = SACH.NS GROUP BY tua) WHERE solanmuon = (SELECT MIN(solanmuon) FROM (SELECT tua, COUNT(*) AS solanmuon FROM TACPHAM JOIN SACH ON TACPHAM.NT = SACH.NT JOIN MUON ON MUON.NS = SACH.NS GROUP BY tua) );

-- cau22
WITH dem AS (SELECT D.ND, D.ten, COUNT(DISTINCT T.NT) AS sotacphammuon FROM DOCGIA D JOIN MUON M ON M.ND = D.ND JOIN SACH S ON S.NS = M.NS JOIN TACPHAM T ON T.NT = S.NT GROUP BY D.ND, D.ten ) SELECT ten, sotacphammuon FROM dem WHERE sotacphammuon = (SELECT MAX(sotacphammuon) FROM dem);

-- cau23
WITH dem AS (SELECT D.ND, D.ten, COUNT(DISTINCT T.NT) AS sotacphammuon FROM DOCGIA D JOIN MUON M ON M.ND = D.ND JOIN SACH S ON S.NS = M.NS JOIN TACPHAM T ON T.NT = S.NT GROUP BY D.ND, D.ten ) SELECT ten, sotacphammuon FROM dem WHERE sotacphammuon = (SELECT MIN(sotacphammuon) FROM dem);

-- cau24
SELECT ten FROM DOCGIA WHERE ND IN (SELECT ND FROM MUON WHERE NS IN (SELECT NS FROM SACH WHERE NT IN (SELECT NT FROM TACPHAM WHERE tacgia = 'Victor Hugo')));

-- cau25
SELECT ten, tua FROM MUON JOIN DOCGIA ON DOCGIA.ND = MUON.ND JOIN SACH ON SACH.NS = MUON.NS JOIN TACPHAM ON TACPHAM.NT = SACH.NT WHERE TO_CHAR(ngaymuon, 'YYYY') = '2007';

-- cau26
SELECT DISTINCT T.tua FROM TACPHAM T JOIN SACH S ON T.NT = S.NT WHERE S.NS NOT IN(SELECT NS FROM MUON);

-- cau27
SELECT DISTINCT T.tua FROM TACPHAM T WHERE NOT EXISTS ( SELECT 1 FROM SACH S WHERE S.NT = T.NT AND S.NS NOT IN (SELECT NS FROM MUON));

-- cau28
SELECT ho, ten FROM DOCGIA WHERE NOT EXISTS (SELECT 1 FROM MUON WHERE MUON.ND = DOCGIA.ND);

-- cau29
SELECT DISTINCT nxb FROM SACH WHERE NS NOT IN (SELECT NS FROM MUON);

-- cau30
SELECT tua, COUNT(*) FROM TACPHAM JOIN SACH ON TACPHAM.NT = SACH.NT GROUP BY tua HAVING COUNT (*) >= 3;

-- cau31
SELECT * FROM DOCGIA WHERE ND = ALL ( SELECT ND FROM MUON WHERE NS IN (SELECT NS FROM SACH WHERE NT IN(SELECT NT FROM TACPHAM WHERE tua = 'Madame Bovary')));

-- cau32
SELECT * FROM DOCGIA D WHERE D.ND <> (SELECT ND FROM DOCGIA WHERE ho = 'Raymond' AND ten = 'Carole') AND NOT EXISTS (SELECT NS FROM MUON WHERE ND = (SELECT ND FROM DOCGIA WHERE ho = 'Raymond' AND ten = 'Carole') MINUS SELECT NS FROM MUON WHERE ND = D.ND) AND NOT EXISTS (SELECT NS FROM MUON WHERE ND = D.ND MINUS SELECT NS FROM MUON WHERE ND = (SELECT ND FROM DOCGIA WHERE ho = 'Raymond' AND ten = 'Carole'));
